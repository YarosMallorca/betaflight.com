"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2328],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(n),h=o,f=d["".concat(c,".").concat(h)]||d[h]||u[h]||a;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=h;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},52411:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var r=n(87462),o=(n(67294),n(3905));const a={},i=void 0,l={unversionedId:"archive/DFU-Hijacking",id:"archive/DFU-Hijacking",title:"DFU-Hijacking",description:"Introduction",source:"@site/docs/archive/DFU-Hijacking.md",sourceDirName:"archive",slug:"/archive/DFU-Hijacking",permalink:"/docs/archive/DFU-Hijacking",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Current-Sensor-Calibration",permalink:"/docs/archive/Current-Sensor-Calibration"},next:{title:"DSHOT-ESC-Protocol",permalink:"/docs/archive/DSHOT-ESC-Protocol"}},c={},s=[{value:"Introduction",id:"introduction",level:2},{value:"What is DFU Hijacking?",id:"what-is-dfu-hijacking",level:2},{value:"Possible Workarounds",id:"possible-workarounds",level:2},{value:"Note:",id:"note",level:3}],p={toc:s};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"If your board is not going into DFU mode"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"even if you are 120% sure that you have a right set of drivers installed for flashing and a healthy set of computer hardwares including USB cable, or"),(0,o.kt)("li",{parentName:"ul"},"even if you can flash other boards with the host computer environment, or"),(0,o.kt)("li",{parentName:"ul"},"the board goes into DFU intermittently under some special conditions,")),(0,o.kt)("p",null,"then this page may explain why and provide you with a work around."),(0,o.kt)("h2",{id:"what-is-dfu-hijacking"},"What is DFU Hijacking?"),(0,o.kt)("p",null,"STM32 family of MCUs, when in boot loader mode, look for input from several different peripherals, including USB VCP and UARTs. If there is a chatty device connected a UART and sends something looks valid, then the boot loader ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"focus"))," es on the UART port and try to load a firmware from the UART port. In other words, the chatty device ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"hijack"))," s the boot loader."),(0,o.kt)("h2",{id:"possible-workarounds"},"Possible Workarounds"),(0,o.kt)("p",null,"Work arounds against DFU hijacking by chatty devices are as follow."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Shut the chatty device up by powering them down or physically disconnecting while flashing. Using a power supply pad not powered when only USB is connected is an alternative way of doing this.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Many receivers does not send valid output until they are first bound (connected) to a transmitter after power cycle. Turning off your transmitter before powering up such receiver prevents the hijacking in this case.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Use half-duplex protocol and use TX pin to connect the chatty devices. Since the boot loader does not turn on half-duplex and only listens to RX pin, something received on TX pin does not induce the hijacking.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Avoid connecting chatty devices to boot loader sensitive UART ports. The boot loader sensitive UART ports on F4 are PA10, PB11 and PC11. For CLRACINGF4 (and JBF4), UART1 (PA10) and UART3 (PB11) falls into this category. Well designed FCs avoids assigning default receiver port the boot loader sensitive pins."))),(0,o.kt)("h3",{id:"note"},"Note:"),(0,o.kt)("p",null,"If none of the above solves the problem you need to look at your ",(0,o.kt)("a",{parentName:"p",href:"https://opensource.com/article/18/11/udev"},"udev")," rules."))}d.isMDXComponent=!0}}]);