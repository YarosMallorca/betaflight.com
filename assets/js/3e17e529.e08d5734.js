"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1507],{72230:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>h});var i=t(85893),o=t(11151);const r={},s="Git and Github",c={id:"development/Git",title:"Git and Github",description:"Contributing to Betaflight involves preparing your development environment and making a fork of the repository and working with Git. This document gives some instructions how to handle Git.",source:"@site/docs/development/Git.md",sourceDirName:"development",slug:"/development/Git",permalink:"/docs/development/Git",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"development",previous:{title:"Getting Started",permalink:"/docs/development/Getting-Started"},next:{title:"GPS",permalink:"/docs/development/Gps"}},a={},h=[{value:"Clone your fork to your development machine.",id:"clone-your-fork-to-your-development-machine",level:2},{value:"Global configuration",id:"global-configuration",level:2},{value:"Recommended git global environment:",id:"recommended-git-global-environment",level:2},{value:"Setup remotes",id:"setup-remotes",level:2},{value:"Create a branch and start making changes",id:"create-a-branch-and-start-making-changes",level:2},{value:"Stage files for commit",id:"stage-files-for-commit",level:2},{value:"Make more changes and commit on top of last commit",id:"make-more-changes-and-commit-on-top-of-last-commit",level:2},{value:"Update master branch with upstream updates and update your fork",id:"update-master-branch-with-upstream-updates-and-update-your-fork",level:2},{value:"Update your local branch with upstream changes",id:"update-your-local-branch-with-upstream-changes",level:2},{value:"Unstage file from working area",id:"unstage-file-from-working-area",level:2},{value:"Recover from unwanted commit without push",id:"recover-from-unwanted-commit-without-push",level:2},{value:"If you want to completely remove the unstaged changes run",id:"if-you-want-to-completely-remove-the-unstaged-changes-run",level:2},{value:"Unwanted commits in your latest push.",id:"unwanted-commits-in-your-latest-push",level:2},{value:"See general changes",id:"see-general-changes",level:2},{value:"See changes in particular file",id:"see-changes-in-particular-file",level:2},{value:"Checkout work on another machine",id:"checkout-work-on-another-machine",level:2},{value:"Quickly testing a PR",id:"quickly-testing-a-pr",level:2},{value:"Squash your commits",id:"squash-your-commits",level:2},{value:"Commit to a PR from another contributor",id:"commit-to-a-pr-from-another-contributor",level:2},{value:"How to sign your commits with PGP",id:"how-to-sign-your-commits-with-pgp",level:2},{value:"Bisection",id:"bisection",level:2},{value:"Links",id:"links",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"git-and-github",children:"Git and Github"}),"\n",(0,i.jsx)(n.p,{children:"Contributing to Betaflight involves preparing your development environment and making a fork of the repository and working with Git. This document gives some instructions how to handle Git."}),"\n",(0,i.jsxs)(n.p,{children:["Look in ",(0,i.jsx)(n.a,{href:"/docs/category/building",children:"development/building"})," for installation notes for your environment."]}),"\n",(0,i.jsx)(n.p,{children:"Please contribute to this article to help others make git easier to use."}),"\n",(0,i.jsx)(n.h2,{id:"clone-your-fork-to-your-development-machine",children:"Clone your fork to your development machine."}),"\n",(0,i.jsx)(n.p,{children:"First make a fork of the repository you want to work on from the github website."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git clone https://github.com/yourname/betaflight.git\n"})}),"\n",(0,i.jsx)(n.h2,{id:"global-configuration",children:"Global configuration"}),"\n",(0,i.jsx)(n.p,{children:"Please configure this to have the correct author in your commits"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'git config --global user.name "Your Name"\ngit config --global user.email "your@email.domain"\n'})}),"\n",(0,i.jsx)(n.p,{children:"If you omit to configure this you get a warning and have to use the following commands to rectify:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git config --global --edit\ngit commit --amend --reset-author\n"})}),"\n",(0,i.jsx)(n.h2,{id:"recommended-git-global-environment",children:"Recommended git global environment:"}),"\n",(0,i.jsx)(n.h1,{id:"windows",children:"Windows:"}),"\n",(0,i.jsx)(n.p,{children:"git config --global core.autocrlf true"}),"\n",(0,i.jsx)(n.h1,{id:"linuxosx",children:"Linux/OSX:"}),"\n",(0,i.jsx)(n.p,{children:"git config --global core.autocrlf input"}),"\n",(0,i.jsx)(n.h1,{id:"cross-platform",children:"Cross-platform:"}),"\n",(0,i.jsx)(n.p,{children:"git config --global core.safecrlf warn\ngit config --global core.whitespace cr-at-eol\ngit config --global core.filemode false\ngit config --global help.autocorrect true"}),"\n",(0,i.jsx)(n.h2,{id:"setup-remotes",children:"Setup remotes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git remote add upstream https://github.com/betaflight/betaflight.git\ngit remote -v\n"})}),"\n",(0,i.jsx)(n.h2,{id:"create-a-branch-and-start-making-changes",children:"Create a branch and start making changes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git checkout -b branch\n"})}),"\n",(0,i.jsx)(n.h2,{id:"stage-files-for-commit",children:"Stage files for commit"}),"\n",(0,i.jsx)(n.p,{children:"Commit your changes after making initial changes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'git add .\ngit commit -m "message"\ngit push origin branch\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note: ",(0,i.jsx)(n.code,{children:"git commit -am"})," or specify the files."]}),"\n",(0,i.jsx)(n.h2,{id:"make-more-changes-and-commit-on-top-of-last-commit",children:"Make more changes and commit on top of last commit"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git commit --amend\ngit push origin +branch\n"})}),"\n",(0,i.jsx)(n.h2,{id:"update-master-branch-with-upstream-updates-and-update-your-fork",children:"Update master branch with upstream updates and update your fork"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git checkout master\ngit pull --rebase upstream master\ngit push origin +master\n"})}),"\n",(0,i.jsx)(n.h2,{id:"update-your-local-branch-with-upstream-changes",children:"Update your local branch with upstream changes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git checkout branch\ngit branch --set-upstream-to=upstream/master branch\ngit pull --rebase\n"})}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git pull upstream master\ngit rebase -i master\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you look at ",(0,i.jsx)(n.code,{children:"git reflog --oneline"})," you will see these lines:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"shacode HEAD@{0}: rebase (finish): returning to refs/head/branch\nshacode HEAD@{1}: rebase (pick): your branch commit description\nshacode (upstream/master, origin/master, origin/HEAD, master) HEAD@{2}: rebase (start): checkout longsha\n"})}),"\n",(0,i.jsx)(n.h2,{id:"unstage-file-from-working-area",children:"Unstage file from working area"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git restore --staged \\<file> to unstage a file from working area.\n"})}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git checkout --\\<filename>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"recover-from-unwanted-commit-without-push",children:"Recover from unwanted commit without push"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git reset HEAD^\n"})}),"\n",(0,i.jsx)(n.h2,{id:"if-you-want-to-completely-remove-the-unstaged-changes-run",children:"If you want to completely remove the unstaged changes run"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git reset --hard HEAD\n"})}),"\n",(0,i.jsx)(n.h2,{id:"unwanted-commits-in-your-latest-push",children:"Unwanted commits in your latest push."}),"\n",(0,i.jsx)(n.p,{children:"First try:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git rebase -i origin/branch~2 branch\ngit push origin +branch\n"})}),"\n",(0,i.jsx)(n.p,{children:"If this fails, backup your changed files (maybe also could use git stash)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git reset HEAD~ --hard\ngit checkout branch\n"})}),"\n",(0,i.jsx)(n.p,{children:"And restore your saved files (or use git stash pop)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'git add .\ngit commit -m "Make new commit"\ngit push origin +branch\n'})}),"\n",(0,i.jsx)(n.h2,{id:"see-general-changes",children:"See general changes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git diff\n"})}),"\n",(0,i.jsx)(n.h2,{id:"see-changes-in-particular-file",children:"See changes in particular file"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git log -- src/main/cms/cms` .c\n"})}),"\n",(0,i.jsx)(n.h2,{id:"checkout-work-on-another-machine",children:"Checkout work on another machine"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git checkout origin/branch\ngit switch -c branch\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quickly-testing-a-pr",children:"Quickly testing a PR"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git fetch upstream pull/2500/head:2500\ngit checkout 2500\n"})}),"\n",(0,i.jsx)(n.h2,{id:"squash-your-commits",children:"Squash your commits"}),"\n",(0,i.jsxs)(n.p,{children:["From the project folder you can use somethink like: ",(0,i.jsx)(n.a,{href:"https://www.scraggo.com/how-to-squash-commits",children:"https://www.scraggo.com/how-to-squash-commits"}),".\nNote the number of commits in your PR."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git rebase -i HEAD~17\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"You should see a list of commits, each commit starting with the word \u201cpick\u201d."}),"\n",(0,i.jsx)(n.li,{children:"Make sure the topmost, first commit says \u201cpick\u201d and change the rest below from \u201cpick\u201d to \u201csquash\u201d. This will squash each commit into the previous commit, which will continue until every commit is squashed into the first commit."}),"\n",(0,i.jsx)(n.li,{children:"Save and close the editor."}),"\n",(0,i.jsx)(n.li,{children:"It will give you the opportunity to change the commit message. What you see is a single message containing all of the commit messages. Edit these as you wish."}),"\n",(0,i.jsx)(n.li,{children:"Save and close the editor again."}),"\n",(0,i.jsx)(n.li,{children:"Important: If you\u2019ve already pushed commits to origin, and then squash them locally, you will have to force the push to your branch."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Finally update with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git push origin +branch\n"})}),"\n",(0,i.jsx)(n.h2,{id:"commit-to-a-pr-from-another-contributor",children:"Commit to a PR from another contributor"}),"\n",(0,i.jsx)(n.p,{children:"Sometimes you want to make changes to an existing PR.\nBefore doing so please ask permission from the contributor.\nIn the example please substitute the contributor, betaflight_project and branch:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git remote add contributor https://github.com/contributor/betaflight_project.git\ngit remote -v\ngit fetch contributor\ngit switch branch\n"})}),"\n",(0,i.jsx)(n.p,{children:"The original author now can pull the changes to the local branch with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git fetch origin branch:branch --update-head-ok\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now you can make more changes and commit again. (This should just work with git pull - have to check this)"}),"\n",(0,i.jsx)(n.h1,{id:"advanced",children:"Advanced"}),"\n",(0,i.jsx)(n.h2,{id:"how-to-sign-your-commits-with-pgp",children:"How to sign your commits with PGP"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key",children:"https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key"})]}),"\n",(0,i.jsx)(n.p,{children:"When using commit just add the -S flag to verify the commit and enter the passphrase you have chosen before."}),"\n",(0,i.jsx)(n.h2,{id:"bisection",children:"Bisection"}),"\n",(0,i.jsx)(n.p,{children:"Do bisection:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git bisect reset\ngit bisect start\ngit checkout 4.1.1\n"})}),"\n",(0,i.jsx)(n.p,{children:"Build and make sure it works"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git bisect good\ngit checkout 4.1.2\n"})}),"\n",(0,i.jsx)(n.p,{children:"Build and make sure it fails"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"git bisect bad\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then git will automatically bisects commits between the two versions, checks out a new bisecting commit.\nYou will build and test it, and tell git if the commit was good or bad."}),"\n",(0,i.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://devconnected.com/how-to-remove-files-from-git-commit/",children:"https://devconnected.com/how-to-remove-files-from-git-commit/"})})]})}function d(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>s});var i=t(67294);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);